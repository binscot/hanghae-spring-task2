<!DOCTYPE html>
<html lang="en"  xmlns:th="http://www.thymeleaf.org">
<!--xmlns="http://www.w3.org/1999/xhtml"-->
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">
  <meta charset="UTF-8">

  <!-- Bulma CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
  <!-- Font Awesome CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- JS -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

  <title>회원가입 페이지</title>
  <style>
    .wrap{
      width: 300px;
      margin: 200px auto;
    }
    .a{
      margin-top: 30px;
      width: 300px;

    }
    .b{
      margin-top: 15px;
    }
    .c{margin-top: 15px}
    .d{
      margin-top: 30px;
      width: 300px;
    }
    .dup{
      width: 300px;
      margin-top: 30px;
    }
    .help-btn{
      font-size: 14px;
      color: #8e8383;
    }
  </style>
  <script>

    function is_nickname(asValue) {
      var regExp = /^[a-zA-Z0-9]{3,20}$/;
      return regExp.test(asValue);
    }

    function checkdup() {
      let nickname = $('#nickname').val();
      var passwordCheck = document.getElementById('passwordCheck').value;
      var password = document.getElementById('password').value;
      $.ajax({
        type: "POST",
        url: "/api/check",
        contentType: "application/json", // JSON 형식으로 전달함을 알리기
        data: nickname,password,passwordCheck,
        success: function (response) {
          if (response === "중복") {
            alert("중복된 아이디 입니다.")
            }else if (nickname=='') {
            alert("아이디를 입력해주세요!")
          }
            // } else if (password != passwordCheck){
            //   alert("비밀번호와 비밀번호확인이 일치하지 않습니다.")
            // }
          else if (!is_nickname(nickname)){
              alert("아이디 형식을 확인해 주세요!")
            } else if (password.match(nickname) == nickname){
            alert("아이디가 비밀번호에 들어갈 수 없습니다.")
          } else {
              const target = document.getElementById('login-id-submit');
              target.disabled = false;
              alert("회원가입 버튼을 눌러주세요!")
            }
        }
      });
    }



  </script>
</head>
<body>
<section class="hero">
  <div class="hero-body">
    <p class="title">
      The bulletin board.
    </p>
    <p class="subtitle">
      It's just a bulletin board.
    </p>
  </div>
</section>
<div id="login-form" class="wrap">

  <form action="/user/signup" method="post">
    <input class="input a" type="text" id="nickname" name="username" placeholder="아이디">
    <p id="help-id" class="help-btn">아이디는 3-10자의 영문과 숫자만 입력 가능합니다.</p>
    <input class="input b" type="password" name="password" id="password" placeholder="비밀번호">
    <p  class="help-btn">비밀번호는 4자 이상 입력해주세요</p>
    <input class="input c" id="passwordCheck" name="passwordCheck" type="password" placeholder="비밀번호 확인">
    <button id="login-id-submit" disabled='disabled'  class="button is-primary is-light d" onclick="sign_up()" >회원가입</button>
    <P class="help-btn">아이디 중복확인, 비밀번호 확인을 하시면 활성화 됩니다!</P>
  </form>
  <button class="button dup is-primary" onclick="checkdup()">아이디 중복 확인 및 비밀번호 확인</button>
</div>

</body>
</html>